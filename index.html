<!DOCTYPE html>
<html>
<head>
  <link rel="manifest" href="manifest.json">
  <meta charset="UTF-8">
  <title>Hacker Authenticator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      background:#000;
      color:#0aff0a;
      font-family:"Courier New", monospace;
      margin:0;
      padding:0;
    }

    /* TOP BAR */
    .topbar {
      background:#001900;
      padding:15px;
      text-align:center;
      font-size:22px;
      border-bottom:1px solid #0aff0a;
      text-shadow:0 0 10px #0aff0a;
    }

    /* NAV BUTTONS */
    .nav {
      display:flex;
      border-bottom:1px solid #0aff0a;
    }
    .nav button {
      flex:1;
      padding:12px;
      background:#000;
      border:0;
      border-right:1px solid #0aff0a;
      color:#0aff0a;
      font-family:inherit;
      font-size:16px;
    }
    .nav button:last-child {
      border-right:0;
    }
    .nav button.active {
      background:#002200;
      font-weight:bold;
    }

    /* CONTENT */
    .page {
      padding:20px;
    }
    .hidden { display:none; }

    /* CARDS */
    .card {
      border:1px solid #0aff0a;
      padding:15px;
      margin-top:15px;
      border-radius:8px;
      box-shadow:0 0 10px #0aff0a55;
    }
    .code {
      font-size:40px;
      margin-top:10px;
      text-shadow:0 0 10px #0aff0a;
    }
    .timer {
      font-size:14px;
      opacity:0.7;
    }

    input, button.action {
      width:100%;
      padding:10px;
      margin-top:10px;
      background:#001900;
      border:1px solid #0aff0a;
      color:#0aff0a;
      border-radius:5px;
      font-family:inherit;
    }
    button.action:hover {
      background:#003300;
    }
    .delete {
      background:#330000;
      border-color:#ff4444;
      color:#ff4444;
    }
  </style>
</head>

<body ontouchstart="">

  <div class="topbar">AUTHENTICATOR</div>

  <div class="nav">
    <button id="navAccounts" class="active" onclick="showPage('accounts')" ontouchstart="">Accounts</button>
    <button id="navAdd" onclick="showPage('add')" ontouchstart="">Add New</button>
  </div>

  <div id="accountsPage" class="page">
    <div id="accounts"></div>
  </div>

  <div id="addPage" class="page hidden">
    <input id="label" placeholder="Label (e.g. Google)">
    <input id="secret" placeholder="Secret (Base32)">
    <button class="action" type="button" onclick="addAccount()">Add Account</button>
  </div>

  <!-- LOCAL SCRIPT -->
  <script src="otpauth.js"></script>

  <script>
    if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
    var accounts = [];
    try {
      accounts = JSON.parse(localStorage.getItem("accounts") || "[]");
    } catch(e) {
      accounts = [];
    }

    function save() {
      localStorage.setItem("accounts", JSON.stringify(accounts));
    }

    function showPage(page) {
      document.getElementById("accountsPage").classList.add("hidden");
      document.getElementById("addPage").classList.add("hidden");
      document.getElementById("navAccounts").classList.remove("active");
      document.getElementById("navAdd").classList.remove("active");

      if (page === "accounts") {
        document.getElementById("accountsPage").classList.remove("hidden");
        document.getElementById("navAccounts").classList.add("active");
      } else {
        document.getElementById("addPage").classList.remove("hidden");
        document.getElementById("navAdd").classList.add("active");
      }
    }

    function addAccount() {
      var label = document.getElementById("label").value.trim();
      var secret = document.getElementById("secret").value.trim();
      if (!label || !secret) return;

      accounts.push({ label: label, secret: secret });
      save();
      render();
      showPage("accounts");
    }

    function deleteAccount(i) {
      accounts.splice(i, 1);
      save();
      render();
    }

    function generateCode(secret) {
      var totp = new OTPAuth.TOTP({
        secret: OTPAuth.Secret.fromB32(secret)
      });
      return totp.generate();
    }

    function render() {
      var container = document.getElementById("accounts");
      container.innerHTML = "";

      accounts.forEach(function(acc, i) {
        var div = document.createElement("div");
        div.className = "card";
        div.innerHTML =
          "<h3>" + acc.label + "</h3>" +
          "<div class='code' id='code-" + i + "'>------</div>" +
          "<div class='timer' id='timer-" + i + "'></div>" +
          "<button type='button' class='delete' onclick='deleteAccount(" + i + ")'>Delete</button>";
        container.appendChild(div);
      });
    }

    function update() {
      var now = Math.floor(Date.now() / 1000);
      var remaining = 30 - (now % 30);

      accounts.forEach(function(acc, i) {
        try {
          var code = generateCode(acc.secret);
          document.getElementById("code-" + i).textContent = code;
          document.getElementById("timer-" + i).textContent =
            "refreshing in " + remaining + "s";
        } catch(e) {
          document.getElementById("code-" + i).textContent = "ERR";
        }
      });
    }

    render();
    setInterval(update, 1000);
  </script>

</body>
</html>


